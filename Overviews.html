<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  
  <title>Overview</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/feather-icons"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body class="bg-gray-100 text-gray-900">
  <div class="flex h-screen">
    <!-- Sidebar -->
    <div class="w-64 bg-green-700 text-purple-100 flex-shrink-0 overflow-y-auto">
      <div class="p-5 border-b border-white-900">
        <h1 class="text-2xl font-bold flex items-center">
          <i data-feather="package" class="mr-2"></i>
          Frinso Tech          
        </h1>
      </div>
      <nav class="mt-4">
        <a href="Dashboard.html" class="flex items-center px-4 py-3 hover:bg-yellow-500" style="font-size: 22px;">
          <i data-feather="bar-chart-2" class="mr-3"></i> Dashboard
        </a>
        <a href="Device.html" class="flex items-center px-4 py-3 hover:bg-yellow-500" style="font-size: 22px;">
          <i data-feather="user" class="mr-3"></i> Device
        </a>
        <a href="Report.html" class="flex items-center px-4 py-3 hover:bg-yellow-500" style="font-size: 22px;">
          <i data-feather="cpu" class="mr-3"></i> Report
        </a>
        <a href="Alert.html" class="flex items-center px-4 py-3 hover:bg-yellow-500" style="font-size: 22px;">
          <i data-feather="bell" class="mr-3"></i> Alert
        </a>
        <a href="Entry.html" class="flex items-center px-4 py-3 hover:bg-yellow-500" style="font-size: 22px;">
          <i data-feather="book" class="mr-3"></i> Manual Entry
        </a>
      </nav>
    </div>

    <!-- Main Content -->
    <div class="flex-1 flex flex-col">
      <!-- Header -->
      <header class="p-4 flex items-center justify-left bg-gradient-to-r from-green-400 via-yellow-300 to-red-400">
        <h2 id="deviceTitle" class="text-2xl font-bold"></h2>
      </header>

      <!-- Top Cards -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">

        <div class="bg-white rounded-2xl shadow-lg p-6 border-t-4 border-yellow-500 hover:shadow-2xl transition">
  <h1 class="text-2xl font-bold text-gray-800 mb-3 flex items-center">
    <i data-feather="cpu" class="mr-2 text-green-600"></i> DG Status
  </h1>
  <div id="dgMessage" class="mt-4 p-3 rounded-lg text-center font-bold bg-gray-200">
    Loading...
  </div>
</div>

<!-- Disruptions -->
<div class="bg-white rounded-2xl shadow-lg p-6 border-t-4 border-red-500 hover:shadow-2xl transition">
  <h3 class="text-2xl font-bold mb-3">Disruptions</h3>
  <ul id="disruptionsList" class="space-y-3">
    <!-- Dynamic data from Firebase -->
  </ul>
</div>
        <!-- Vendor Activity -->
        <div class="bg-white rounded-2xl shadow-lg p-6 border-t-4 border-green-500">
          <h3 class="text-2xl font-bold mb-3">Vendor Activity</h3>
          <canvas id="vendorChart"></canvas>
        </div>

        <!-- Fuel -->
        <div class="bg-white rounded-2xl shadow-lg p-6 border-t-4 border-blue-500 hover:shadow-2xl transition">
  <h3 class="text-2xl font-bold mb-3">Fuel (Diesel Delta)</h3>
  <div id="fuelInfo" class="space-y-2 text-lg bg-gray-100 p-4 rounded-lg shadow-inner">Loading...</div>
</div>

      </div>

      <!-- Graphs -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
        <div class="bg-white rounded-lg shadow-md p-6">
          <h3 class="text-2xl font-semibold mb-3">Time vs Power</h3>
          <canvas id="timePowerChart"></canvas>
        </div>
        <div class="bg-white rounded-lg shadow-md p-6">
          <h3 class="text-2xl font-semibold mb-3">Fuel vs Power</h3>
          <canvas id="fuelPowerChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <script>
    feather.replace();

    // Firebase Init
    const firebaseConfig = {
      apiKey: "AIzaSyB4yz1uGoIsdGskjpw8Sd_l11DRwEp9bm8",
      authDomain: "dashboard-5ad70.firebaseapp.com",
      databaseURL: "https://dashboard-5ad70-default-rtdb.firebaseio.com",
      projectId: "dashboard-5ad70",
      storageBucket: "dashboard-5ad70.firebasestorage.app",
      messagingSenderId: "271639896344",
      appId: "1:271639896344:web:fdc6b2d3820b099f96be6d",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Get Device from URL
    const urlParams = new URLSearchParams(window.location.search);
    const deviceId = urlParams.get("id");
    const deviceAlias = urlParams.get("alias") || "Unknown Device";
    document.getElementById("deviceTitle").textContent = `${deviceAlias} (${deviceId})`;

    // Charts
    const timeCtx = document.getElementById("timePowerChart").getContext("2d");
    const timePowerChart = new Chart(timeCtx, {
      type: "line",
      data: { labels: [], datasets: [{ label: "Power (kW)", data: [], borderColor: "#8B5CF6", fill: true }] },
      options: { responsive: true }
    });

    const fuelCtx = document.getElementById("fuelPowerChart").getContext("2d");
    const fuelPowerChart = new Chart(fuelCtx, {
      type: "bar",
      data: { labels: ["Fuel Added", "Fuel Consumed", "Power Generated"], datasets: [{ data: [0,0,0], backgroundColor: ["#F59E0B", "#EF4444", "#10B981"] }] },
      options: { responsive: true }
    });

    const vendorCtx = document.getElementById("vendorChart").getContext("2d");
    const vendorChart = new Chart(vendorCtx, {
      type: "doughnut",
      data: { labels: ["Fuel Refill", "Maintenance", "Network Fix"], datasets: [{ data: [0,0,0], backgroundColor: ["#10B981", "#F59E0B", "#3B82F6"] }] }
    });

    // Realtime Firebase Listener
    const deviceRef = db.ref("devices/" + deviceId);
  deviceRef.on("value", (snapshot) => {
    const data = snapshot.val();
    if (!data) return;

    // DG Status
    const dgBox = document.getElementById("dgMessage");
    dgBox.textContent = data.dgStatus || "Status Unknown";
    dgBox.className = "mt-4 p-3 rounded-lg text-center font-bold " +
      (data.dgStatus.includes("Critical") ? "bg-red-500 text-white" :
       data.dgStatus.includes("fluctuation") ? "bg-orange-500 text-white" :
       data.dgStatus.includes("low") ? "bg-yellow-500 text-white" :
       "bg-green-500 text-white");

    // Disruptions
    const disruptions = document.getElementById("disruptionsList");
    disruptions.innerHTML = `
      <li class="p-2 rounded ${data.power === "Normal" ? "bg-green-100 text-green-700" : "bg-red-100 text-red-700"}">‚ö° Power: ${data.power}</li>
      <li class="p-2 rounded ${data.fuel.includes("Low") ? "bg-yellow-100 text-yellow-700" : "bg-green-100 text-green-700"}">‚õΩ Fuel: ${data.fuel}</li>
      <li class="p-2 rounded ${data.oil === "Critical" ? "bg-red-100 text-red-700" : "bg-green-100 text-green-700"}">üõ¢Ô∏è Oil: ${data.oil}</li>
      <li class="p-2 rounded bg-blue-100 text-blue-700">üå°Ô∏è Temp: ${data.temp}</li>
      <li class="p-2 rounded bg-purple-100 text-purple-700">üîã Battery: ${data.battery}</li>
    `;

    // Fuel Info
    document.getElementById("fuelInfo").innerHTML = `
      <p><span class="font-semibold">Vendor:</span> ${data.vendor || "-"}</p>
      <p><span class="font-semibold">Before:</span> ${data.fuelBefore || "-"} L</p>
      <p><span class="font-semibold">After:</span> ${data.fuelAfter || "-"} L</p>
      <p><span class="font-semibold">Delta:</span> <span class="font-bold text-blue-700">${data.fuelDelta || "-"}</span></p>
    `;
  
      // Charts update
      timePowerChart.data.labels.push(new Date().toLocaleTimeString());
      timePowerChart.data.datasets[0].data.push(data.powerKW || 0);
      if (timePowerChart.data.labels.length > 10) {
        timePowerChart.data.labels.shift();
        timePowerChart.data.datasets[0].data.shift();
      }
      timePowerChart.update();

      fuelPowerChart.data.datasets[0].data = [
        data.fuelAdded || 0,
        data.fuelConsumed || 0,
        data.powerKW || 0
      ];
      fuelPowerChart.update();

      vendorChart.data.datasets[0].data = [
        data.vendorFuel || 0,
        data.vendorMaintenance || 0,
        data.vendorNetwork || 0
      ];
      vendorChart.update();
    });
  </script>
</body>
</html>
